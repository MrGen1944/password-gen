{% extends 'passencrypt/base.html' %}

{% block title %}Generate Password - PassEncrypt{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="text-center mb-4">
            <h2 class="fw-bold text-primary">
                <i class="fas fa-key"></i> Password Generator
            </h2>
            <p class="text-muted">Create strong, secure passwords with customizable options</p>
        </div>
    </div>
</div>

<div class="row">
    <!-- Generator Form -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-cog"></i> Configuration</h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Policy Selection -->
                    <div class="mb-3">
                        <label for="{{ form.use_policy.id_for_label }}" class="form-label">
                            <i class="fas fa-list"></i> Use Predefined Policy
                        </label>
                        {{ form.use_policy }}
                        <small class="form-text text-muted">Select a policy or use custom settings below</small>
                    </div>
                    
                    <hr>
                    
                    <!-- Length Settings -->
                    <div class="row mb-3">
                        <div class="col-6">
                            <label for="{{ form.min_length.id_for_label }}" class="form-label">
                                Min Length
                            </label>
                            {{ form.min_length }}
                        </div>
                        <div class="col-6">
                            <label for="{{ form.max_length.id_for_label }}" class="form-label">
                                Max Length
                            </label>
                            {{ form.max_length }}
                        </div>
                    </div>
                    
                    <!-- Character Type Options -->
                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-font"></i> Character Types</label>
                        
                        <div class="form-check">
                            {{ form.include_uppercase }}
                            <label class="form-check-label" for="{{ form.include_uppercase.id_for_label }}">
                                Include Uppercase Letters (A-Z)
                            </label>
                        </div>
                        
                        <div class="form-check">
                            {{ form.include_lowercase }}
                            <label class="form-check-label" for="{{ form.include_lowercase.id_for_label }}">
                                Include Lowercase Letters (a-z)
                            </label>
                        </div>
                        
                        <div class="form-check">
                            {{ form.include_numbers }}
                            <label class="form-check-label" for="{{ form.include_numbers.id_for_label }}">
                                Include Numbers (0-9)
                            </label>
                        </div>
                        
                        <div class="form-check">
                            {{ form.include_symbols }}
                            <label class="form-check-label" for="{{ form.include_symbols.id_for_label }}">
                                Include Symbols (!@#$%^&*)
                            </label>
                        </div>
                        
                        <div class="form-check">
                            {{ form.exclude_similar }}
                            <label class="form-check-label" for="{{ form.exclude_similar.id_for_label }}">
                                Exclude Similar Characters (0, O, l, 1, I)
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="fas fa-magic"></i> Generate Password
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Result Display -->
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-key"></i> Generated Password</h5>
            </div>
            <div class="card-body">
                {% if generated_password %}
                    <div class="password-result mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span id="generated-password">{{ generated_password }}</span>
                            <button type="button" class="copy-btn" onclick="copyToClipboard('{{ generated_password }}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Password Analysis -->
                    <div class="password-analysis">
                        <h6><i class="fas fa-chart-bar"></i> Password Analysis</h6>
                        <div class="row text-center">
                            <div class="col-4">
                                <div class="bg-light p-2 rounded">
                                    <strong>{{ generated_password|length }}</strong><br>
                                    <small>Characters</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="bg-light p-2 rounded">
                                    <strong id="strength-score">Strong</strong><br>
                                    <small>Strength</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="bg-light p-2 rounded">
                                    <strong>High</strong><br>
                                    <small>Entropy</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Security Tip:</strong> Copy this password immediately and store it securely. 
                            This page will be cleared when you navigate away.
                        </div>
                    </div>
                {% else %}
                    <div class="text-center text-muted">
                        <i class="fas fa-arrow-left fa-3x mb-3 opacity-25"></i>
                        <p>Configure your password settings and click "Generate Password" to create a secure password.</p>
                        
                        <div class="mt-4">
                            <h6>Quick Tips:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-lightbulb text-warning"></i> Longer passwords are more secure</li>
                                <li><i class="fas fa-lightbulb text-warning"></i> Include multiple character types</li>
                                <li><i class="fas fa-lightbulb text-warning"></i> Avoid dictionary words</li>
                            </ul>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Quick Actions -->
        {% if generated_password %}
        <div class="card mt-3">
            <div class="card-body text-center">
                <h6>Quick Actions</h6>
                <a href="{% url 'encrypt' %}" class="btn btn-outline-primary">
                    <i class="fas fa-lock"></i> Encrypt This Password
                </a>
                <button type="button" class="btn btn-outline-secondary" onclick="clearPage()">
                    <i class="fas fa-redo"></i> Generate Another
                </button>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    // Auto-hide password after 5 minutes for security
    {% if generated_password %}
    setTimeout(function() {
        const passwordElement = document.getElementById('generated-password');
        if (passwordElement) {
            passwordElement.innerHTML = '<span class="text-muted"><i>Password hidden for security</i></span>';
        }
    }, 300000); // 5 minutes
    {% endif %}
    
    // Clear page and reset to default state
    function clearPage() {
        // Clear all form fields
        document.querySelectorAll('form').forEach(form => {
            form.reset();
            form.classList.remove('was-validated'); // Remove validation styling
        });
        
        // Clear all input fields specifically
        document.querySelectorAll('input[type="number"], input[type="checkbox"]').forEach(input => {
            if (input.type === 'checkbox') {
                input.checked = input.hasAttribute('checked'); // Reset to default state
            } else {
                input.value = input.defaultValue; // Reset to default value
            }
        });
        
        // Reset select fields to first option (empty option)
        document.querySelectorAll('select').forEach(select => {
            select.selectedIndex = 0;
        });
        
        // Clear any displayed results
        const resultCard = document.querySelector('.card.border-success');
        if (resultCard) {
            // Replace result with default message
            const cardBody = resultCard.querySelector('.card-body');
            cardBody.innerHTML = `
                <div class="text-center text-muted">
                    <i class="fas fa-arrow-left fa-3x mb-3 opacity-25"></i>
                    <p>Configure your password settings and click "Generate Password" to create a secure password.</p>
                    
                    <div class="mt-4">
                        <h6>Quick Tips:</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-lightbulb text-warning"></i> Longer passwords are more secure</li>
                            <li><i class="fas fa-lightbulb text-warning"></i> Include multiple character types</li>
                            <li><i class="fas fa-lightbulb text-warning"></i> Avoid dictionary words</li>
                        </ul>
                    </div>
                </div>
            `;
        }
        
        // Remove quick actions card if it exists
        const quickActionsCard = document.querySelector('.card.mt-3');
        if (quickActionsCard && quickActionsCard.textContent.includes('Quick Actions')) {
            quickActionsCard.remove();
        }
        
        // Trigger policy selection change to reset field states
        const policySelect = document.getElementById('{{ form.use_policy.id_for_label }}');
        if (policySelect) {
            policySelect.dispatchEvent(new Event('change'));
        }
        
        // Show success message
        showNotification('Page cleared! Ready for new password generation.', 'success');
    }
    
    // Dynamic form updates based on policy selection
    document.addEventListener('DOMContentLoaded', function() {
        const policySelect = document.getElementById('{{ form.use_policy.id_for_label }}');
        const customFields = document.querySelectorAll('input[type="number"], input[type="checkbox"]');
        
        if (policySelect) {
            policySelect.addEventListener('change', function() {
                const isCustom = this.value === '';
                customFields.forEach(field => {
                    // Don't disable fields, just style them differently
                    if (!isCustom) {
                        field.parentElement.style.opacity = '0.6';
                        field.style.pointerEvents = 'none';
                    } else {
                        field.parentElement.style.opacity = '1';
                        field.style.pointerEvents = 'auto';
                    }
                });
            });
            
            // Trigger on page load
            policySelect.dispatchEvent(new Event('change'));
        }
    });
</script>
{% endblock %}